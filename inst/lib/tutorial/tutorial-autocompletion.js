"use strict";function TutorialCompleter(tutorial){this.$tutorial=tutorial;var self=this;this.$onChange=function(data){clearTimeout(this.$autocompletionTimerId);data=data||{};if(data.action!=="insert"){return}var lines=data.lines||[];if(lines.length!==1){return}var pos=this.getCursorPosition();var line=this.session.getLine(pos.row);var popup=(this.completer||{}).popup;if(popup&&popup.isOpen&&!/::$/.test(line)){return}var delayMs=300;if(/[$@]$|::$/.test(line)){delayMs=10}this.$autocompletionTimerId=setTimeout(this.$liveAutocompleter,delayMs)};var MODIFIER_NONE=0;var MODIFIER_CTRL=1;var MODIFIER_ALT=2;var MODIFIER_SHIFT=4;var KEYCODE_TAB=9;var KEYCODE_SPACE=32;var KeyCombination=function KeyCombination(event){this.keyCode=event.keyCode||event.which;this.modifier=MODIFIER_NONE;this.modifier|=event.ctrlKey?MODIFIER_CTRL:0;this.modifier|=event.altKey?MODIFIER_ALT:0;this.modifier|=event.shiftKey?MODIFIER_SHIFT:0};function initializeAceEventListeners(editor){var handlers={};handlers.change=self.$onChange.bind(editor);handlers.destroy=function(event){for(var key in handlers){this.off(key,handlers[key])}}.bind(editor);for(var key in handlers){editor.on(key,handlers[key])}}function initializeCompletionEngine(editor){editor.completers=editor.completers||[];editor.completers.push({getCompletions:function getCompletions(editor,session,position,prefix,callback){var contents=session.getTextRange({start:{row:0,column:0},end:position});var payload={contents:contents,label:editor.tutorial.label};self.$tutorial.$serverRequest("completion",payload,function(data){data=data||[];var completer={insertMatch:function insertMatch(editor,data){var ranges=editor.selection.getAllRanges();var completions=editor.completer.completions;var n=completions.filterText.length;for(var i=0;i<ranges.length;i++){ranges[i].start.column-=n;editor.session.remove(ranges[i])}var term=data.value+(data.is_function?"()":"");editor.execCommand("insertstring",term);if(data.is_function){editor.navigateLeft(1)}}};var completions=data.map(function(el){return{caption:el[0]+(el[1]?"()":""),value:el[0],score:0,meta:"R",is_function:el[1],completer:completer}});callback(null,completions)})}});editor.setOptions({enableBasicAutocompletion:true,enableLiveAutocompletion:false})}function initializeSetupChunk(editor){var data=editor.tutorial;self.$tutorial.$serverRequest("initialize_chunk",data)}function ensureInitialized(editor){if(!editor.tutorial.completion){return}if(editor.$autocompletionInitialized){return}initializeAceEventListeners(editor);initializeCompletionEngine(editor);initializeSetupChunk(editor);if(typeof editor.$liveAutocompleter==="undefined"){editor.$liveAutocompleter=function(){this.execCommand("startAutocomplete")}.bind(editor)}editor.$autocompletionInitialized=1}function findActiveAceInstance(){var el=document.activeElement;while(el!=null){if(el.env&&el.env.editor){return el.env.editor}el=el.parentElement}return null}function autocomplete(event){var editor=findActiveAceInstance();if(editor==null){return}if(!editor.tutorial.completion){return}ensureInitialized(editor);clearTimeout(editor.$autocompletionTimerId);var keys=new KeyCombination(event);if(keys.keyCode===KEYCODE_TAB){if(editor.container.matches(".ace_indent_off")){return}var pos=editor.getCursorPosition();var line=editor.session.getLine(pos.row);var isCursorAtStart=line.substr(0,pos.column).trim()==="";if(isCursorAtStart){return}}event.stopPropagation();event.preventDefault();editor.execCommand("startAutocomplete")}document.addEventListener("keydown",function(event){var editor=findActiveAceInstance();if(editor!==null){ensureInitialized(editor)}if(editor!==null&&!editor.tutorial.completion){return}var keys=new KeyCombination(event);if(keys.keyCode===KEYCODE_TAB&&keys.modifier===MODIFIER_NONE){if(editor&&editor.completer&&editor.completer.activated){return}return autocomplete(event)}if(keys.keyCode===KEYCODE_SPACE&&keys.modifier===MODIFIER_CTRL){return autocomplete(event)}},true)}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy1qcy90dXRvcmlhbC90dXRvcmlhbC1hdXRvY29tcGxldGlvbi5qcyJdLCJuYW1lcyI6WyJUdXRvcmlhbENvbXBsZXRlciIsInR1dG9yaWFsIiwiJHR1dG9yaWFsIiwic2VsZiIsIiRvbkNoYW5nZSIsImRhdGEiLCJjbGVhclRpbWVvdXQiLCIkYXV0b2NvbXBsZXRpb25UaW1lcklkIiwiYWN0aW9uIiwibGluZXMiLCJsZW5ndGgiLCJwb3MiLCJnZXRDdXJzb3JQb3NpdGlvbiIsImxpbmUiLCJzZXNzaW9uIiwiZ2V0TGluZSIsInJvdyIsInBvcHVwIiwiY29tcGxldGVyIiwiaXNPcGVuIiwidGVzdCIsImRlbGF5TXMiLCJzZXRUaW1lb3V0IiwiJGxpdmVBdXRvY29tcGxldGVyIiwiTU9ESUZJRVJfTk9ORSIsIk1PRElGSUVSX0NUUkwiLCJNT0RJRklFUl9BTFQiLCJNT0RJRklFUl9TSElGVCIsIktFWUNPREVfVEFCIiwiS0VZQ09ERV9TUEFDRSIsIktleUNvbWJpbmF0aW9uIiwiZXZlbnQiLCJrZXlDb2RlIiwid2hpY2giLCJtb2RpZmllciIsImN0cmxLZXkiLCJhbHRLZXkiLCJzaGlmdEtleSIsImluaXRpYWxpemVBY2VFdmVudExpc3RlbmVycyIsImVkaXRvciIsImhhbmRsZXJzIiwiY2hhbmdlIiwiYmluZCIsImRlc3Ryb3kiLCJrZXkiLCJvZmYiLCJvbiIsImluaXRpYWxpemVDb21wbGV0aW9uRW5naW5lIiwiY29tcGxldGVycyIsInB1c2giLCJnZXRDb21wbGV0aW9ucyIsInBvc2l0aW9uIiwicHJlZml4IiwiY2FsbGJhY2siLCJjb250ZW50cyIsImdldFRleHRSYW5nZSIsInN0YXJ0IiwiY29sdW1uIiwiZW5kIiwicGF5bG9hZCIsImxhYmVsIiwiJHNlcnZlclJlcXVlc3QiLCJpbnNlcnRNYXRjaCIsInJhbmdlcyIsInNlbGVjdGlvbiIsImdldEFsbFJhbmdlcyIsImNvbXBsZXRpb25zIiwibiIsImZpbHRlclRleHQiLCJpIiwicmVtb3ZlIiwidGVybSIsInZhbHVlIiwiaXNfZnVuY3Rpb24iLCJleGVjQ29tbWFuZCIsIm5hdmlnYXRlTGVmdCIsIm1hcCIsImVsIiwiY2FwdGlvbiIsInNjb3JlIiwibWV0YSIsInNldE9wdGlvbnMiLCJlbmFibGVCYXNpY0F1dG9jb21wbGV0aW9uIiwiZW5hYmxlTGl2ZUF1dG9jb21wbGV0aW9uIiwiaW5pdGlhbGl6ZVNldHVwQ2h1bmsiLCJlbnN1cmVJbml0aWFsaXplZCIsImNvbXBsZXRpb24iLCIkYXV0b2NvbXBsZXRpb25Jbml0aWFsaXplZCIsImZpbmRBY3RpdmVBY2VJbnN0YW5jZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImVudiIsInBhcmVudEVsZW1lbnQiLCJhdXRvY29tcGxldGUiLCJrZXlzIiwiY29udGFpbmVyIiwibWF0Y2hlcyIsImlzQ3Vyc29yQXRTdGFydCIsInN1YnN0ciIsInRyaW0iLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhY3RpdmF0ZWQiXSwibWFwcGluZ3MiOiJhQUFBLFFBQVNBLENBQUFBLGlCQUFULENBQTRCQyxRQUE1QixDQUFzQyxDQUNwQyxLQUFLQyxTQUFMLENBQWlCRCxRQUFqQixDQUNBLEdBQU1FLENBQUFBLElBQUksQ0FBRyxJQUFiLENBRUEsS0FBS0MsU0FBTCxDQUFpQixTQUFVQyxJQUFWLENBQWdCLENBQy9CQyxZQUFZLENBQUMsS0FBS0Msc0JBQU4sQ0FBWixDQUNBRixJQUFJLENBQUdBLElBQUksRUFBSSxFQUFmLENBSUEsR0FBSUEsSUFBSSxDQUFDRyxNQUFMLEdBQWdCLFFBQXBCLENBQThCLENBQUUsTUFBUSxDQUV4QyxHQUFNQyxDQUFBQSxLQUFLLENBQUdKLElBQUksQ0FBQ0ksS0FBTCxFQUFjLEVBQTVCLENBQ0EsR0FBSUEsS0FBSyxDQUFDQyxNQUFOLEdBQWlCLENBQXJCLENBQXdCLENBQUUsTUFBUSxDQUlsQyxHQUFNQyxDQUFBQSxHQUFHLENBQUcsS0FBS0MsaUJBQUws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RUFBSUEsTUFBTSxDQUFDckIsU0FBakIsRUFBOEJxQixNQUFNLENBQUNyQixTQUFQLENBQWlCcUYsU0FBbkQsQ0FBOEQsQ0FFNUQsTUFDRCxDQUVELE1BQU9WLENBQUFBLFlBQVksQ0FBQzlELEtBQUQsQ0FDcEIsQ0FFRCxHQUFJK0QsSUFBSSxDQUFDOUQsT0FBTCxHQUFpQkgsYUFBakIsRUFBa0NpRSxJQUFJLENBQUM1RCxRQUFMLEdBQWtCVCxhQUF4RCxDQUF1RSxDQUNyRSxNQUFPb0UsQ0FBQUEsWUFBWSxDQUFDOUQsS0FBRCxDQUNwQixDQUNGLENBckJELENBcUJHLElBckJILENBc0JEIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gVHV0b3JpYWxDb21wbGV0ZXIgKHR1dG9yaWFsKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgdGhpcy4kdHV0b3JpYWwgPSB0dXRvcmlhbFxuICBjb25zdCBzZWxmID0gdGhpc1xuXG4gIHRoaXMuJG9uQ2hhbmdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy4kYXV0b2NvbXBsZXRpb25UaW1lcklkKVxuICAgIGRhdGEgPSBkYXRhIHx8IHt9XG5cbiAgICAvLyBvbmx5IHBlcmZvcm0gbGl2ZSBhdXRvY29tcGxldGlvbiB3aGlsZSB1c2VyXG4gICAgLy8gaXMgdHlwaW5nIChpZSwgc2luZ2xlLWNoYXJhY3RlciB0ZXh0IGluc2VydGlvbnMpXG4gICAgaWYgKGRhdGEuYWN0aW9uICE9PSAnaW5zZXJ0JykgeyByZXR1cm4gfVxuXG4gICAgY29uc3QgbGluZXMgPSBkYXRhLmxpbmVzIHx8IFtdXG4gICAgaWYgKGxpbmVzLmxlbmd0aCAhPT0gMSkgeyByZXR1cm4gfVxuXG4gICAgLy8gTk9URTogQWNlIGhhcyBhbHJlYWR5IHVwZGF0ZWQgdGhlIGRvY3VtZW50IGxpbmUgYXQgdGhpcyBwb2ludFxuICAgIC8vIHNvIHdlIGNhbiBqdXN0IGxvb2sgYXQgdGhlIHN0YXRlIG9mIHRoYXQgbGluZVxuICAgIGNvbnN0IHBvcyA9IHRoaXMuZ2V0Q3Vyc29yUG9zaXRpb24oKVxuICAgIGNvbnN0IGxpbmUgPSB0aGlzLnNlc3Npb24uZ2V0TGluZShwb3Mucm93KVxuXG4gICAgLy8gTk9URTogd2UgYWxsb3cgbmV3IGF1dG9jb21wbGV0aW9uIHNlc3Npb25zIGZvbGxvd2luZyBhXG4gICAgLy8gJzonIGluc2VydGlvbiBqdXN0IHRvIGVuYWJsZSBjYXNlcyB3aGVyZSB0aGUgdXNlciBpc1xuICAgIC8vIHR5cGluZyBlLmcuICdzdGF0czo6cm5vcm0oKScgd2hpbGUgdGhlIHBvcHVwIGlzIHZpc2libGVcbiAgICBjb25zdCBwb3B1cCA9ICh0aGlzLmNvbXBsZXRlciB8fCB7fSkucG9wdXBcbiAgICBpZiAocG9wdXAgJiYgcG9wdXAuaXNPcGVuICYmICEvOjokLy50ZXN0KGxpbmUpKSB7IHJldHVybiB9XG5cbiAgICAvLyBmaWd1cmUgb3V0IGFwcHJvcHJpYXRlIGRlbGF5IC0tIHdhbnQgdG8gYXV0b2NvbXBsZXRlXG4gICAgLy8gaW1tZWRpYXRlbHkgYWZ0ZXIgYSAnJCcgb3IgJ0AnIGluc2VydGlvbiwgYnV0IG5lZWQgdG9cbiAgICAvLyBleGVjdXRlIG9uIHRpbWVvdXQgdG8gYWxsb3cgQWNlIHRvIGZpbmlzaCBwcm9jZXNzaW5nXG4gICAgLy8gZXZlbnRzIChpZiBhbnkpXG4gICAgbGV0IGRlbGF5TXMgPSAzMDBcbiAgICBpZiAoL1skQF0kfDo6JC8udGVzdChsaW5lKSkgeyBkZWxheU1zID0gMTAgfVxuXG4gICAgdGhpcy4kYXV0b2NvbXBsZXRpb25UaW1lcklkID0gc2V0VGltZW91dCh0aGlzLiRsaXZlQXV0b2NvbXBsZXRlciwgZGVsYXlNcylcbiAgfVxuXG4gIGNvbnN0IE1PRElGSUVSX05PTkUgPSAwXG4gIGNvbnN0IE1PRElGSUVSX0NUUkwgPSAxXG4gIGNvbnN0IE1PRElGSUVSX0FMVCA9IDJcbiAgY29uc3QgTU9ESUZJRVJfU0hJRlQgPSA0XG5cbiAgY29uc3QgS0VZQ09ERV9UQUIgPSA5XG4gIGNvbnN0IEtFWUNPREVfU1BBQ0UgPSAzMlxuXG4gIGNvbnN0IEtleUNvbWJpbmF0aW9uID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdGhpcy5rZXlDb2RlID0gZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaFxuICAgIHRoaXMubW9kaWZpZXIgPSBNT0RJRklFUl9OT05FXG4gICAgdGhpcy5tb2RpZmllciB8PSBldmVudC5jdHJsS2V5ID8gTU9ESUZJRVJfQ1RSTCA6IDBcbiAgICB0aGlzLm1vZGlmaWVyIHw9IGV2ZW50LmFsdEtleSA/IE1PRElGSUVSX0FMVCA6IDBcbiAgICB0aGlzLm1vZGlmaWVyIHw9IGV2ZW50LnNoaWZ0S2V5ID8gTU9ESUZJRVJfU0hJRlQgOiAwXG4gIH1cblxuICBmdW5jdGlvbiBpbml0aWFsaXplQWNlRXZlbnRMaXN0ZW5lcnMgKGVkaXRvcikge1xuICAgIC8vIE5PVEU6IGVhY2ggQWNlIGluc3RhbmNlIGdldHMgaXRzIG93biBoYW5kbGVycywgc29cbiAgICAvLyB3ZSBkb24ndCBzdG9yZSB0aGVzZSBhcyBpbnN0YW5jZSB2YXJpYWJsZXMgb24gdGhlXG4gICAgLy8gVHV0b3JpYWxDb21wbGV0ZXIgaW5zdGFuY2UgKGFzIHdlIGhhdmUgMSBUdXRvcmlhbENvbXBsZXRlclxuICAgIC8vIGhhbmRsaW5nIGNvbXBsZXRpb25zIGZvciBhbGwgQWNlIGluc3RhbmNlcylcbiAgICBjb25zdCBoYW5kbGVycyA9IHt9XG5cbiAgICBoYW5kbGVycy5jaGFuZ2UgPSBzZWxmLiRvbkNoYW5nZS5iaW5kKGVkaXRvcilcbiAgICBoYW5kbGVycy5kZXN0cm95ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBoYW5kbGVycykgeyB0aGlzLm9mZihrZXksIGhhbmRsZXJzW2tleV0pIH1cbiAgICB9LmJpbmQoZWRpdG9yKVxuXG4gICAgLy8gcmVnaXN0ZXIgb3VyIGhhbmRsZXJzIG9uIHRoZSBBY2UgZWRpdG9yXG4gICAgZm9yIChjb25zdCBrZXkgaW4gaGFuZGxlcnMpIHsgZWRpdG9yLm9uKGtleSwgaGFuZGxlcnNba2V5XSkgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5pdGlhbGl6ZUNvbXBsZXRpb25FbmdpbmUgKGVkaXRvcikge1xuICAgIGVkaXRvci5jb21wbGV0ZXJzID0gZWRpdG9yLmNvbXBsZXRlcnMgfHwgW11cbiAgICBlZGl0b3IuY29tcGxldGVycy5wdXNoKHtcblxuICAgICAgZ2V0Q29tcGxldGlvbnM6IGZ1bmN0aW9uIChlZGl0b3IsIHNlc3Npb24sIHBvc2l0aW9uLCBwcmVmaXgsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIHNlbmQgYXV0b2NvbXBsZXRpb24gcmVxdWVzdCB3aXRoIGRvY3VtZW50IGNvbnRlbnRzIHVwIHRvIGN1cnNvclxuICAgICAgICAvLyBwb3NpdGlvbiAoZG9uZSB0byBlbmFibGUgbXVsdGktbGluZSBhdXRvY29tcGxldGlvbnMpXG4gICAgICAgIGNvbnN0IGNvbnRlbnRzID0gc2Vzc2lvbi5nZXRUZXh0UmFuZ2Uoe1xuICAgICAgICAgIHN0YXJ0OiB7IHJvdzogMCwgY29sdW1uOiAwIH0sXG4gICAgICAgICAgZW5kOiBwb3NpdGlvblxuICAgICAgICB9KVxuXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgY29udGVudHM6IGNvbnRlbnRzLFxuICAgICAgICAgIGxhYmVsOiBlZGl0b3IudHV0b3JpYWwubGFiZWxcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYuJHR1dG9yaWFsLiRzZXJ2ZXJSZXF1ZXN0KCdjb21wbGV0aW9uJywgcGF5bG9hZCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBkYXRhID0gZGF0YSB8fCBbXVxuXG4gICAgICAgICAgLy8gZGVmaW5lIGEgY3VzdG9tIGNvbXBsZXRlciAtLSB1c2VkIGZvciBlLmcuIGF1dG9tYXRpY1xuICAgICAgICAgIC8vIHBhcmVudGhlc2lzIGluc2VydGlvbiwgYW5kIHNvIG9uXG4gICAgICAgICAgY29uc3QgY29tcGxldGVyID0ge1xuICAgICAgICAgICAgaW5zZXJ0TWF0Y2g6IGZ1bmN0aW9uIChlZGl0b3IsIGRhdGEpIHtcbiAgICAgICAgICAgICAgLy8gcmVtb3ZlIHByZWZpeFxuICAgICAgICAgICAgICBjb25zdCByYW5nZXMgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldEFsbFJhbmdlcygpXG4gICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zID0gZWRpdG9yLmNvbXBsZXRlci5jb21wbGV0aW9uc1xuICAgICAgICAgICAgICBjb25zdCBuID0gY29tcGxldGlvbnMuZmlsdGVyVGV4dC5sZW5ndGhcbiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICByYW5nZXNbaV0uc3RhcnQuY29sdW1uIC09IG5cbiAgICAgICAgICAgICAgICBlZGl0b3Iuc2Vzc2lvbi5yZW1vdmUocmFuZ2VzW2ldKVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gaW5zZXJ0IGNvbXBsZXRpb24gdGVybSAoYWRkIHBhcmVudGhlc2VzIGZvciBmdW5jdGlvbnMpXG4gICAgICAgICAgICAgIGNvbnN0IHRlcm0gPSBkYXRhLnZhbHVlICsgKGRhdGEuaXNfZnVuY3Rpb24gPyAnKCknIDogJycpXG4gICAgICAgICAgICAgIGVkaXRvci5leGVjQ29tbWFuZCgnaW5zZXJ0c3RyaW5nJywgdGVybSlcblxuICAgICAgICAgICAgICAvLyBtb3ZlIGN1cnNvciBiYWNrd2FyZHMgZm9yIGZ1bmN0aW9uc1xuICAgICAgICAgICAgICBpZiAoZGF0YS5pc19mdW5jdGlvbikgeyBlZGl0b3IubmF2aWdhdGVMZWZ0KDEpIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBjb21wbGV0aW9ucyA9IGRhdGEubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgY2FwdGlvbjogZWxbMF0gKyAoZWxbMV0gPyAnKCknIDogJycpLFxuICAgICAgICAgICAgICB2YWx1ZTogZWxbMF0sXG4gICAgICAgICAgICAgIHNjb3JlOiAwLFxuICAgICAgICAgICAgICBtZXRhOiAnUicsXG4gICAgICAgICAgICAgIGlzX2Z1bmN0aW9uOiBlbFsxXSxcbiAgICAgICAgICAgICAgY29tcGxldGVyOiBjb21wbGV0ZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgY29tcGxldGlvbnMpXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICB9KVxuXG4gICAgZWRpdG9yLnNldE9wdGlvbnMoe1xuICAgICAgZW5hYmxlQmFzaWNBdXRvY29tcGxldGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZUxpdmVBdXRvY29tcGxldGlvbjogZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gaW5pdGlhbGl6ZVNldHVwQ2h1bmsgKGVkaXRvcikge1xuICAgIGNvbnN0IGRhdGEgPSBlZGl0b3IudHV0b3JpYWxcbiAgICBzZWxmLiR0dXRvcmlhbC4kc2VydmVyUmVxdWVzdCgnaW5pdGlhbGl6ZV9jaHVuaycsIGRhdGEpXG4gIH1cblxuICBmdW5jdGlvbiBlbnN1cmVJbml0aWFsaXplZCAoZWRpdG9yKSB7XG4gICAgLy8gYmFpbCBpZiBjb21wbGV0aW9ucyBhcmUgZGlzYWJsZWQgZm9yIHRoaXMgZWRpdG9yXG4gICAgaWYgKCFlZGl0b3IudHV0b3JpYWwuY29tcGxldGlvbikgeyByZXR1cm4gfVxuXG4gICAgaWYgKGVkaXRvci4kYXV0b2NvbXBsZXRpb25Jbml0aWFsaXplZCkgeyByZXR1cm4gfVxuXG4gICAgaW5pdGlhbGl6ZUFjZUV2ZW50TGlzdGVuZXJzKGVkaXRvcilcbiAgICBpbml0aWFsaXplQ29tcGxldGlvbkVuZ2luZShlZGl0b3IpXG4gICAgaW5pdGlhbGl6ZVNldHVwQ2h1bmsoZWRpdG9yKVxuXG4gICAgLy8gZ2VuZXJhdGUgYSBsaXZlIGF1dG9jb21wbGV0ZXIgZm9yIHRoaXMgZWRpdG9yIGlmXG4gICAgLy8gbm90IHlldCBhdmFpbGFibGVcbiAgICBpZiAodHlwZW9mIGVkaXRvci4kbGl2ZUF1dG9jb21wbGV0ZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBlZGl0b3IuJGxpdmVBdXRvY29tcGxldGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmV4ZWNDb21tYW5kKCdzdGFydEF1dG9jb21wbGV0ZScpXG4gICAgICB9LmJpbmQoZWRpdG9yKVxuICAgIH1cblxuICAgIGVkaXRvci4kYXV0b2NvbXBsZXRpb25Jbml0aWFsaXplZCA9IDFcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRBY3RpdmVBY2VJbnN0YW5jZSAoKSB7XG4gICAgbGV0IGVsID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudFxuICAgIHdoaWxlIChlbCAhPSBudWxsKSB7XG4gICAgICBpZiAoZWwuZW52ICYmIGVsLmVudi5lZGl0b3IpIHsgcmV0dXJuIGVsLmVudi5lZGl0b3IgfVxuICAgICAgZWwgPSBlbC5wYXJlbnRFbGVtZW50XG4gICAgfVxuICAgIHJldHVybiBudWxsXG4gIH1cblxuICBmdW5jdGlvbiBhdXRvY29tcGxldGUgKGV2ZW50KSB7XG4gICAgLy8gZmluZCBhY3RpdmUgQWNlIGluc3RhbmNlXG4gICAgY29uc3QgZWRpdG9yID0gZmluZEFjdGl2ZUFjZUluc3RhbmNlKClcbiAgICBpZiAoZWRpdG9yID09IG51bGwpIHsgcmV0dXJuIH1cblxuICAgIC8vIGJhaWwgaWYgY29tcGxldGlvbnMgYXJlIGRpc2FibGVkIGZvciB0aGlzIGVkaXRvclxuICAgIGlmICghZWRpdG9yLnR1dG9yaWFsLmNvbXBsZXRpb24pIHsgcmV0dXJuIH1cblxuICAgIC8vIGVuc3VyZSBjb21wbGV0aW9uIGVuZ2luZSBpbml0aWFsaXplZFxuICAgIGVuc3VyZUluaXRpYWxpemVkKGVkaXRvcilcblxuICAgIC8vIGNhbmNlbCBhbnkgcGVuZGluZyBsaXZlIGF1dG9jb21wbGV0aW9uXG4gICAgY2xlYXJUaW1lb3V0KGVkaXRvci4kYXV0b2NvbXBsZXRpb25UaW1lcklkKVxuXG4gICAgY29uc3Qga2V5cyA9IG5ldyBLZXlDb21iaW5hdGlvbihldmVudClcblxuICAgIGlmIChrZXlzLmtleUNvZGUgPT09IEtFWUNPREVfVEFCKSB7XG4gICAgICAvLyBkb24ndCBhdXRvY29tcGxldGUgd2hlbiB0YWJiaW5nIGF3YXkgZnJvbSBlZGl0b3JcbiAgICAgIGlmIChlZGl0b3IuY29udGFpbmVyLm1hdGNoZXMoJy5hY2VfaW5kZW50X29mZicpKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICAvLyBjaGVjayB0aGF0IHdlJ3JlIG5vdCBhdCB0aGUgc3RhcnQgb2YgdGhlIGxpbmVcbiAgICAgIGNvbnN0IHBvcyA9IGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpXG4gICAgICBjb25zdCBsaW5lID0gZWRpdG9yLnNlc3Npb24uZ2V0TGluZShwb3Mucm93KVxuICAgICAgY29uc3QgaXNDdXJzb3JBdFN0YXJ0ID0gbGluZS5zdWJzdHIoMCwgcG9zLmNvbHVtbikudHJpbSgpID09PSAnJ1xuICAgICAgaWYgKGlzQ3Vyc29yQXRTdGFydCkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9XG5cbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ3N0YXJ0QXV0b2NvbXBsZXRlJylcbiAgfVxuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAvLyBUT0RPOiBmaW5kIG1vcmUgYXBwcm9wcmlhdGUgcGxhY2UgZm9yIG9uZS10aW1lIGluaXRpYWxpemF0aW9uXG4gICAgY29uc3QgZWRpdG9yID0gZmluZEFjdGl2ZUFjZUluc3RhbmNlKClcbiAgICBpZiAoZWRpdG9yICE9PSBudWxsKSB7IGVuc3VyZUluaXRpYWxpemVkKGVkaXRvcikgfVxuXG4gICAgLy8gYmFpbCBpZiBjb21wbGV0aW9ucyBhcmUgZGlzYWJsZWQgZm9yIHRoaXMgZWRpdG9yXG4gICAgaWYgKGVkaXRvciAhPT0gbnVsbCAmJiAhZWRpdG9yLnR1dG9yaWFsLmNvbXBsZXRpb24pIHsgcmV0dXJuIH1cblxuICAgIGNvbnN0IGtleXMgPSBuZXcgS2V5Q29tYmluYXRpb24oZXZlbnQpXG4gICAgaWYgKGtleXMua2V5Q29kZSA9PT0gS0VZQ09ERV9UQUIgJiYga2V5cy5tb2RpZmllciA9PT0gTU9ESUZJRVJfTk9ORSkge1xuICAgICAgaWYgKGVkaXRvciAmJiBlZGl0b3IuY29tcGxldGVyICYmIGVkaXRvci5jb21wbGV0ZXIuYWN0aXZhdGVkKSB7XG4gICAgICAgIC8vIGl0IGlzIGFscmVhZHkgYWN0aXZhdGVkLiBBY2NlcHQgdGhlIHRvcCBjaG9pY2UuIFRvIGRvIHRoaXMsIGRvIG5vdGhpbmcgYW5kIGl0IHdpbGwgYmUgcmVzb2x2ZWQgYnkgdGhlIGF1dG9jb21wbGV0ZXJcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgICAvLyBhdXRvY29tcGxldGVyIGlzIG5vdCBhY3RpdmUuIGVuYWJsZSBpdFxuICAgICAgcmV0dXJuIGF1dG9jb21wbGV0ZShldmVudClcbiAgICB9XG5cbiAgICBpZiAoa2V5cy5rZXlDb2RlID09PSBLRVlDT0RFX1NQQUNFICYmIGtleXMubW9kaWZpZXIgPT09IE1PRElGSUVSX0NUUkwpIHtcbiAgICAgIHJldHVybiBhdXRvY29tcGxldGUoZXZlbnQpXG4gICAgfVxuICB9LCB0cnVlKVxufVxuIl19