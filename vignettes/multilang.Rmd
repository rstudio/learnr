---
title: "Internationalization"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{multilang}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

## Language codes and names borrowed from BootBox
# library(rvest)
# read_html("http://bootboxjs.com/documentation.html#bb-locales") %>% 
#   html_table() %>% 
#   .[[6]] %>% 
#   {dplyr::bind_rows(.[, 1:2], .[, 3:4])}

languages <- c("Arabic","Bulgarian","Czech",
    "German","English","Estonian","Farsi / Persian",
    "French / Français","Croatian","Indonesian","Japanese",
    "Korean","Latvian","Norwegian","Portuguese","Slovak",
    "Albanian","Swahili","Thai","Ukrainian",
    "Chinese (People's Republic of China)","Azerbaijani",
    "Portuguese - Brazil","Danish","Greek","Spanish / Español","Basque",
    "Finnish","Hebrew","Hungarian","Italian","Georgian",
    "Lithuanian","Dutch","Polish","Russian","Slovenian",
    "Swedish","Tamil","Turkish","Vietnamese",
    "Chinese (Taiwan / Republic of China)")

names(languages) <- c("ar","bg_BG","cs","de","en",
  "et","fa","fr","hr","id","ja","ko","lv","no",
  "pt","sk","sq","sw","th","uk","zh_CN","az","br",
  "da","el","es","eu","fi","he","hu","it","ka","lt",
  "nl","pl","ru","sl","sv","ta","tr","vi","zh_TW")

# Can't library(learnr) because this is a vignette
tutorial_i18n_custom_language <- learnr::tutorial_i18n_custom_language

learnr_langs <- setdiff(names(learnr:::tutorial_i18n_translations()), "emo")
bb_langs_code <- paste0("`", names(languages), "`")
```

## Choosing a Tutorial's Language

To change the language of the UI element, you can use the following parameter in your YAML: 

```
output: 
  learnr::tutorial:
    language: fr
```

Currently, `r length(learnr_langs)` language translations are supported:

```{r echo=FALSE, results="asis"}
for (lng in learnr_langs) {
  lng_name <- if (lng %in% names(languages)) paste(" for", languages[lng])
  if (lng == "en") paste(lng_name, "(default)")
  cat("\n- `", lng, "`", lng_name, sep = "")
}
```

## Customizable UI elements:

There are many elements whose language can be translated or customized, each identified by a _key_. 
Note that you do not need to customize _all_ of the keys,
the UI will fall back to the default tutorial language for keys that are not specifically customized.

### Buttons

The following keys are available for translating button text:

```yaml
`r learnr:::tutorial_i18n_custom_language_defaults("button")`
```

### Text

The following keys are available for translating text elements:

```yaml
`r learnr:::tutorial_i18n_custom_language_defaults("text")`

```

## Format of `language` Option in YAML Header:

There are several ways that you can use the `language` option
to choose a language translation or to customize the phrasing used in a particular language.

### Default Language

Chose the default language for the tutorial. 
learnr currently provides complete translations for
`r knitr::combine_words(dQuote(setdiff(names(learnr:::tutorial_i18n_translations()), "emo"), q = FALSE))`.
A translation does not need to be available for you to use as the default language,
in particular if you are providing a custom translation for a language without an available complete translation.

If you only want to change the default language, use:

```yaml
language: "fr"
```

If you are also providing language customizations, use:

```yaml
languge:
  default: "fr"
  custom: #...
```

### Customizing a Single Language

To customize the displayed text for a single language, use the following format.
In this format the customization will be applied to the translations of the default language,
which will also be the default language of the tutorial.

```yaml
language:
  default: en
  custom:
    button:
      runcode: Run!
    text:
      startover: Restart!
```

### Customizing Multiple Languages

To provide custom display text for multiple languages, 
provide `custom` with a lists containing `language`, `button` and `text` items. 
Each is optional, and the default language will be `"en"` if `language` is not provided.

```yaml
language:
  default: en
  custom:
    - language: en
      button:
        runcode: Run!
      text:
        startover: Restart!
    - language: es
      button:
        runcode: Ejecutar
```

### Store Customizations in a JSON File

If you intend to reuse the same custom language repeatedly, 
it may be helpful to store the custom language parameters in a JSON file and simply import the file.
In this case, you can provide `custom` with a path to a single JSON file. 
To write the JSON file, adapt the following R code:

```r
jsonlite::write_json(
  c(
    tutorial_i18n_custom_language("en", button = list(runcode = "Run!")),
    tutorial_i18n_custom_language("es", button = list(runcode = "¡Ejecutar código!"))
  ),
  path = "custom_languages.json",
  auto_unbox = TRUE
)
```

And then reference the custom `.json` file in the `custom` item of the `language` option:

```yaml
language:
  default: en
  custom: custom_languages.json
```

## Complete Translations

Complete translations are provided by the internal function `tutorial_i18n_translations()`.
To contribute a complete translation for a language not currently provided by learnr,
please submit a pull request updating the list in `tutorial_i18n_translations()`.
Or you can open an issue with a list such as the one below translated into the language you want.

```{r echo=FALSE, comment = ""}
en <- jsonlite::toJSON(learnr:::tutorial_i18n_translations()["en"], auto_unbox = TRUE, pretty = 2)
en <- gsub("{", "list(", en, fixed = TRUE)
en <- gsub(": ", " = ", en, fixed = TRUE)
gsub("}", ")", en, fixed = TRUE)
```


Note that for the language to be available inside the alert boxes of learnr,
you'll need to set the language to one of the
[language codes used by bootbox](http://bootboxjs.com/documentation.html#bb-locales)[^1].
If your language is not available for `bootbox`, then the buttons will default to English.

[^1]: `r knitr::combine_words(bb_langs_code, and = " or ")`
